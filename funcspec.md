# 機能仕様書 - Auto Capture Shot

## 1. 概要

本アプリケーションは、スマートフォンのモーションセンサーを利用して、デバイスの揺れが少ない安定した状態を検知し、自動で写真を撮影するWebアプリケーションである。
撮影された画像はリアルタイムで画面に表示され、セッション終了後に一括でZIPファイルとしてダウンロードできる。

## 2. 機能一覧

### 2.1. 自動撮影機能

- **安定度判定による自動撮影**:
  - 加速度センサーとジャイロセンサーのデータからデバイスの「揺れ」を計算し、「安定度スコア」を算出する。
  - 安定度スコアがユーザー設定の閾値を超えた場合に、自動で写真を撮影する。
- **撮影クールダウン**:
  - 一度撮影すると、次の撮影まで5秒間のクールダウン期間を設ける。
- **撮影上限**:
  - 1セッションあたりの最大撮影枚数は500枚。上限に達すると自動的に撮影を終了する。
- **視覚フィードバック**:
  - 撮影が成功した瞬間に、画面全体が白くフラッシュする効果でユーザーに通知する。

### 2.2. ユーザーインターフェース (UI)

- **撮影制御**:
  - 「開始」「終了」ボタンで撮影セッションを手動で制御できる。
- **リアルタイム情報表示**:
  - 撮影中、以下の情報をリアルタイムで画面に表示する。
    - 加速度 (x, y, z)
    - 角速度 (α, β, γ)
    - 現在の安定度スコア
    - セッション中の最小・最大スコア
    - 撮影セッションの経過時間
    - 現在の撮影枚数
- **安定度閾値の調整**:
  - スライダーUIを操作して、撮影トリガーとなる安定度スコアの閾値（0.80〜1.00）を動的に変更できる。

### 2.3. ギャラリー機能

- **リアルタイムサムネイル表示**:
  - 撮影された画像は、即座にサムネイルとしてギャラリー領域に追加される。
  - 新しい画像がリストの先頭に表示される。
- **画像拡大表示 (モーダル)**:
  - サムネイルをタップすると、画像がモーダルウィンドウで拡大表示される。
  - モーダル内では、左右のスワイプ操作で前後の画像に切り替えられる。
  - モーダルには「現在の画像番号 / 総枚数」のカウンターが表示される。
  - モーダルは「×」ボタン、またはモーダル外の背景をクリックすることで閉じられる。
- **一括ダウンロード**:
  - 「全画像をZIPでダウンロード」ボタンを押すと、撮影した全ての画像が`best_shots.zip`というファイル名でダウンロードされる。
  - ZIP内の画像ファイル名は `image_001.jpg`, `image_002.jpg` のように連番で命名される。

## 3. 画面仕様

### 3.1. メイン画面

- **初期状態**:
  - 「開始」ボタンとステータスメッセージが表示される。
- **撮影中**:
  - 「終了」ボタンが有効になる。
  - 画面下部にセンサーデータやスコアなどの情報パネルが表示される。
  - 画面上部に撮影された画像のサムネイルギャラリーが表示される。
  - カメラのプレビュー映像は表示されない。

## 4. 技術要件

### 4.1. 実行環境

- **対応ブラウザ**:
  - `DeviceMotionEvent` API および `MediaDevices (getUserMedia)` API をサポートする最新のモバイルブラウザ（Safari on iOS, Chrome on Androidなど）。
- **ハードウェア要件**:
  - カメラ、加速度センサー、ジャイロセンサーを搭載したデバイス。

### 4.2. センサー・API

- **モーションセンサー**:
  - `DeviceMotionEvent` API を使用して加速度と角速度を取得する。
  - iOSデバイスでは、初回アクセス時にユーザーに対して明示的にセンサーへのアクセス許可を要求する。
- **カメラ**:
  - `navigator.mediaDevices.getUserMedia` API を使用して、デバイスの背面カメラ (`facingMode: 'environment'`) の映像を取得する。
  - 取得解像度は 640x480 を目標とする。

### 4.3. 外部ライブラリ

- **JSZip**:
  - 撮影した画像をクライアントサイドでZIP圧縮するために使用する。

### 4.4. オフライン対応

- **Service Worker**:
  - `service-worker.js` により、アプリケーションの主要なリソース（HTML, CSS, JS）がキャッシュされる。
  - これにより、一度アクセスした後はオフライン環境でもアプリケーションを起動できる（PWA）。